<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>poste.ar · ciudadela</title>
    <style>
        :root { --rastro-color: #2e7d32; --gris-suave: #ddd; --texto: #1a1a1a; }
        body { font-family: 'Courier New', Courier, monospace; background: #fff; color: var(--texto); margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        .container { width: 728px; border-left: 1px solid var(--gris-suave); border-right: 1px solid var(--gris-suave); min-height: 100vh; padding: 20px; box-sizing: border-box; }
        
        header { border-bottom: 1px solid var(--gris-suave); padding-bottom: 15px; margin-bottom: 20px; }
        
        /* Tipografía estandar para la marca */
        .brand-line { font-weight: bold; font-size: 16px; margin-bottom: 2px; }
        .sub-brand { font-size: 12px; color: #666; }

        /* Alerta simple de base de datos */
        .alerta-espacio { color: #d32f2f; font-size: 12px; margin: 15px 0; display: block; }

        .nav-status { display: flex; justify-content: space-between; align-items: center; background: #fdfdfd; padding: 10px; border: 1px solid var(--gris-suave); font-size: 13px; margin-top: 15px; }
        
        .avatar { width: 60px; height: 60px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; background: var(--gris-suave); flex-shrink: 0; }
        .pixel { width: 100%; height: 100%; }

        #manual-box { display: none; background: #fff; border: 1px solid var(--gris-suave); padding: 15px; font-size: 13px; white-space: pre-wrap; margin: 15px 0; }

        textarea { width: 100%; height: 100px; border: 1px solid var(--gris-suave); padding: 10px; font-family: inherit; font-size: 15px; resize: none; outline: none; box-sizing: border-box; }
        
        .btn { cursor: pointer; font-family: inherit; font-weight: bold; border: 1px solid var(--gris-suave); padding: 5px 12px; background: #fff; color: #444; font-size: 12px; }
        .btn-postear { background: #000; color: #fff; border: 1px solid #000; padding: 8px 25px; font-size: 14px; }
        
        .post { display: flex; gap: 20px; border-bottom: 1px solid #eee; padding: 25px 0; align-items: flex-start; }
        .post-body { flex-grow: 1; min-width: 0; }
        .marca-tag { font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        
        .oculto-box { margin-top: 10px; font-size: 12px; border: 1px dashed var(--gris-suave); padding: 8px; }
        .contador { font-size: 11px; color: #888; text-align: right; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="brand-line">poste.ar</div>
        <div class="sub-brand">Sitio anónimo, efímero. Ciudadela, Buenos Aires, Argentina.</div>
        
        <span class="alerta-espacio">Base de datos al 72%, se borrará próximamente.</span>

        <div class="nav-status">
            <span>Tu Marca: <b id="current-marca" style="color:var(--rastro-color)">...</b></span>
            <div>
                <button class="btn" onclick="reetiquetar()">[ reetiquetar ]</button>
                <button class="btn" onclick="toggleManual()">[ manual ]</button>
            </div>
        </div>

        <div id="manual-box"></div>
        
        <div style="margin-top: 20px;">
            <textarea id="editor" maxlength="576" placeholder="Escribe aquí... ((secreto|semilla))"></textarea>
            <div class="contador" id="char-count">576 espacios restantes</div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                <button class="btn-postear" onclick="validarYPostear()">[ postear ]</button>
                <button class="btn" onclick="window.open('/source')">[ download source ]</button>
            </div>
        </div>
    </header>

    <div id="timeline"></div>
</div>

<script>
    let miMarca = "";
    let miColor = "";

    function generarNomenclador() {
        const r = () => Math.random().toString(36).substring(2, 6);
        const n = () => Math.floor(Math.random() * 90 + 10);
        return `${r()}.${n()}.${r()}.${n()}`;
    }

    function generateAvatar(containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        const colors = ['#f0f0f0', miColor, '#333', '#aaa'];
        for(let i=0; i<9; i++) {
            const div = document.createElement('div');
            div.className = 'pixel';
            div.style.background = colors[Math.floor(Math.random() * colors.length)];
            container.appendChild(div);
        }
    }

    function toggleManual() {
        const box = document.getElementById('manual-box');
        if(box.style.display === 'block') { box.style.display = 'none'; return; }
        fetch('postear.txt').then(r => r.text()).then(t => {
            box.innerText = t;
            box.style.display = 'block';
        });
    }

    function reetiquetar() {
        miMarca = generarNomenclador();
        miColor = `hsl(${Math.floor(Math.random()*360)}, 60%, 45%)`;
        document.documentElement.style.setProperty('--rastro-color', miColor);
        document.getElementById('current-marca').innerText = miMarca;
    }

    document.getElementById('editor').oninput = function() {
        document.getElementById('char-count').innerText = (576 - this.value.length) + " espacios restantes";
    };

    function validarYPostear() {
        const text = document.getElementById('editor').value;
        if(!text) return;
        if (text.includes("((") && (!text.includes("|") || !text.includes("))"))) {
            alert("Error: Use ((texto|semilla)) para ocultar contenido.");
            return;
        }
        postear(text);
    }

    function postear(text) {
        const timeline = document.getElementById('timeline');
        const post = document.createElement('div');
        post.className = 'post';
        
        const tieneOculto = text.includes("((");
        let htmlContent = text
            .replace(/\*(.*?)\*/g, '<b>$1</b>')
            .replace(/_(.*?)_/g, '<i>$1</i>')
            .replace(/<(.*?):(.*?)>/g, '<a href="http://$2" target="_blank" style="color:blue">$1</a>')
            .replace(/\(\((.*?)\|(.*?)\)\)/g, '<span style="background:#000; color:#000;">▒▒▒▒▒</span>');

        const idAv = 'av-' + Math.random().toString(36).substring(7);
        post.innerHTML = `
            <div class="avatar" id="${idAv}"></div>
            <div class="post-body">
                <div class="marca-tag" style="color:${miColor}">${miMarca}</div>
                <div style="white-space: pre-wrap;">${htmlContent}</div>
                ${tieneOculto ? `
                    <div class="oculto-box">
                        Contenido oculto [x]: 
                        <input type="text" placeholder="semilla..." style="border:none; border-bottom:1px solid #ddd; outline:none; width:120px; font-family:inherit; font-size:11px;">
                    </div>` : ''}
            </div>
        `;
        timeline.prepend(post);
        generateAvatar(idAv);
        document.getElementById('editor').value = '';
        document.getElementById('char-count').innerText = "576 espacios restantes";
    }

    reetiquetar();
</script>
</body>
</html>
